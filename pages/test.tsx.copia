import JokesRepository from '../services/JokesRepository'
import Joke from '../models/Joke'
import { GetStaticProps } from 'next'
import * as ErrorService from '../services/errors.service'
import React from 'react'
import JokeErrorCmp from '../components/JokeErrorCmp'
import JokeErrorModel from '../models/JokeError'

export const getStaticProps: GetStaticProps = async () => {
  let response
  try {
    response = await JokesRepository.getRandomJoke()
    response = await response.json()
  } catch (exception) {
    response = ErrorService.parseError(exception)
  }
  return {
    props: { data: response },
  }
}

export default function Test(props: { data: Joke & JokeErrorModel }) {
  const { data } = props
  if (ErrorService.isError(data)) return <JokeErrorCmp data={data} />
  return <pre>{ErrorService.printJson(data)}</pre>
}
